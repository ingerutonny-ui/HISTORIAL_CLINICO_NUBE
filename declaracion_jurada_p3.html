<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>DECLARACI√ìN JURADA - HOJA 2</title>
    <style>
        :root { --verde: #34a174; --fondo: #f1f5f9; --blanco: #ffffff; }
        body { background-color: var(--fondo); font-family: 'Segoe UI', sans-serif; padding: 20px; text-transform: uppercase; }
        .card { background: var(--blanco); padding: 30px; border-radius: 40px; max-width: 900px; margin: auto; }
        .habito-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 10px; }
        table th, table td { border: 1px solid #ddd; padding: 5px; text-align: center; }
        input, select { width: 100%; border: 1px solid #ccc; border-radius: 5px; padding: 5px; box-sizing: border-box; }
        .btn-finalizar { background: var(--verde); color: white; border: none; padding: 15px; border-radius: 20px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="card">
        <h3>3. H√ÅBITOS (HOJA 2)</h3>
        <form id="formP3">
            <div class="habito-grid">
                <div><label>FUMA</label><select id="h1"><option value="NO">NO</option><option value="SI">SI</option></select><input type="text" id="r1" placeholder="CANTIDAD"></div>
                <div><label>BEBE</label><select id="h2"><option value="NO">NO</option><option value="SI">SI</option></select><input type="text" id="r2" placeholder="FRECUENCIA"></div>
                <div><label>PIJCHA/BOLO</label><select id="h4"><option value="NO">NO</option><option value="SI">SI</option></select></div>
                <div><label>GRUPO SANGU√çNEO</label><input type="text" id="r10" placeholder="EJ. ORH+"></div>
            </div>

            <h3>ANTECEDENTES OCUPACIONALES (HISTORIA LABORAL)</h3>
            <table id="tablaLaboral">
                <thead><tr><th>EDAD INICIO</th><th>EMPRESA</th><th>OCUPACI√ìN</th><th>TIEMPO</th><th>RIESGOS</th><th>EPP</th></tr></thead>
                <tbody>
                    <tr><td><input type="number"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><select><option>SI</option><option>NO</option></select></td></tr>
                </tbody>
            </table>

            <button type="submit" id="btnFinalizar" class="btn-finalizar">FINALIZAR Y GENERAR REPORTE OFICIAL üíæ</button>
        </form>
    </div>
<script>
    document.getElementById('formP3').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btnFinalizar');
        btn.disabled = true;
        
        const payload = {
            paciente_id: parseInt(localStorage.getItem('paciente_id')),
            h1: document.getElementById('h1').value, r1: document.getElementById('r1').value.toUpperCase(),
            h2: document.getElementById('h2').value, r2: document.getElementById('r2').value.toUpperCase(),
            h3: "NO", r3: "N/A", h4: document.getElementById('h4').value, r4: "N/A",
            h5: "NO", r5: "N/A", h6: "N/A", r6: "N/A", h7: "N/A", r7: "N/A",
            h8: "N/A", r8: "N/A", h9: "N/A", r9: "N/A", h10: "N/A", r10: document.getElementById('r10').value.toUpperCase(),
            historia_laboral: "[]" 
        };

        try {
            const res = await fetch('https://historial-clinico-936s.onrender.com/declaraciones/p3/', {
                method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload)
            });
            if(res.ok) {
                alert("‚úì COMPLETADO");
                window.location.href = "generar_pdf.html"; // O donde visualices el PDF
            }
        } catch (err) { alert("Error"); }
        finally { btn.disabled = false; }
    });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>HC NUBE | HÁBITOS (3/3)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f4f8; font-family: 'Segoe UI', sans-serif; }
        .form-container { max-width: 900px; margin: 30px auto; background: white; padding: 40px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .header-ohs { display: flex; align-items: center; justify-content: space-between; border-bottom: 3px solid #22c55e; padding-bottom: 15px; margin-bottom: 25px; }
        .label-custom { font-size: 11px; font-weight: 800; color: #334155; text-transform: uppercase; margin-bottom: 8px; display: block; }
        .form-control, .form-select { border-radius: 10px; padding: 12px; font-size: 14px; text-transform: uppercase; border: 1px solid #e2e8f0; }
        .btn-finish { background: #1e293b; color: white; border: none; padding: 18px; border-radius: 15px; width: 100%; font-weight: 800; text-transform: uppercase; margin-top: 30px; transition: 0.3s; }
        .btn-finish:hover { background: #000; transform: translateY(-2px); }
    </style>
</head>
<body>
<div class="form-container">
    <div class="header-ohs">
        <img src="https://ingerutonny-ui.github.io/HISTORIAL_CLINICO_NUBE/logo.png" height="55">
        <div style="text-align: center; flex: 1;"><h2 style="font-size: 1.4rem; font-weight: 900; color: #1e293b; margin:0;">3. HÁBITOS Y ACTIVIDAD</h2></div>
        <div style="font-size: 11px; font-weight: 800; color: #94a3b8;">PARTE 3 / 3</div>
    </div>

    <form id="formP3" class="row g-4">
        <div class="col-md-6">
            <label class="label-custom">¿Fuma actualmente?</label>
            <select id="tabaco" class="form-select"><option value="NO">NO</option><option value="SI">SI</option></select>
        </div>
        <div class="col-md-6">
            <label class="label-custom">¿Consume bebidas alcohólicas?</label>
            <select id="alcohol" class="form-select"><option value="NO">NO</option><option value="SI">SI</option></select>
        </div>
        <div class="col-md-12">
            <label class="label-custom">Actividad Física / Deportes (Frecuencia)</label>
            <input type="text" id="deporte" class="form-control" placeholder="EJ. CAMINATA DIARIA 30 MIN" oninput="this.value=this.value.toUpperCase()">
        </div>
        <div class="col-md-12">
            <label class="label-custom">Observaciones de Salud Adicionales</label>
            <textarea id="obs" class="form-control" rows="3" oninput="this.value=this.value.toUpperCase()"></textarea>
        </div>
        <button type="submit" id="btnF" class="btn-finish">FINALIZAR Y ENVIAR DECLARACIÓN</button>
    </form>
</div>

<script>
    const API = 'https://historial-clinico-936s.onrender.com';
    document.getElementById('formP3').onsubmit = async (e) => {
        e.preventDefault();
        const b = document.getElementById('btnF');
        b.innerText = "ENVIANDO..."; b.disabled = true;

        const data = {
            paciente_id: parseInt(localStorage.getItem('p_id')),
            fuma: document.getElementById('tabaco').value,
            bebe_alcohol: document.getElementById('alcohol').value,
            deporte: document.getElementById('deporte').value || "NINGUNO",
            observaciones: document.getElementById('obs').value || "SIN OBSERVACIONES"
        };

        try {
            const r = await fetch(`${API}/declaraciones/p3/`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            if(r.ok) {
                alert("DATOS GUARDADOS CORRECTAMENTE");
                window.location.href = "registro_paciente.html";
            } else { alert("ERROR AL GUARDAR P3"); }
        } catch(e) { alert("ERROR DE RED"); }
        finally { b.innerText = "FINALIZAR Y ENVIAR DECLARACIÓN"; b.disabled = false; }
    };
</script>
</body>
</html>

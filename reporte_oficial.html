async function cargarDatos() {
    const id = localStorage.getItem('p_id_reporte');
    if(!id) return;

    const API = "https://historial-clinico-936s.onrender.com";

    try {
        const res = await fetch(`${API}/reporte/${id}`);
        if (!res.ok) throw new Error("Error en servidor");
        
        const data = await res.json();
        const { p, f1, p2, p3 } = data;

        // 1. Membrete e ID
        document.getElementById('p_id_top').innerText = `RA${p.id}`;
        document.getElementById('p_fecha_hoy').innerText = new Date().toLocaleDateString();

        // 2. Mapeo Sección P1 (14 Campos)
        document.getElementById('p_full_name').innerText = `${p.apellido} ${p.nombre}`;
        document.getElementById('p_ci').innerText = p.ci;
        document.getElementById('p_f_nac').innerText = p.fecha_nacimiento;
        
        document.getElementById('p_edad').innerText = f1.edad || '---';
        document.getElementById('p_sexo').innerText = f1.sexo || '---';
        document.getElementById('p_est_civil').innerText = f1.estado_civil || '---';
        document.getElementById('p_lugar_nac').innerText = f1.lugar_nacimiento || '---';
        document.getElementById('p_telf').innerText = f1.telefono || '---';
        document.getElementById('p_domicilio').innerText = f1.domicilio || '---';
        document.getElementById('p_n_casa').innerText = f1.n_casa || '---';
        document.getElementById('p_zona').innerText = f1.zona_barrio || '---';
        document.getElementById('p_ciudad').innerText = f1.ciudad || '---';
        document.getElementById('p_pais').innerText = f1.pais || '---';
        document.getElementById('p_profesion').innerText = f1.profesion_oficio || '---';

        // 3. Aquí mapearías P2 y P3 usando p2.campo y p3.campo...

    } catch (e) {
        console.error("Error cargando reporte:", e);
        // Fallback: Si el reporte falla, al menos intentamos mostrar el nombre del paciente
        document.getElementById('p_full_name').innerText = "ERROR DE CARGA - REINTENTE";
    }
}
window.onload = cargarDatos;

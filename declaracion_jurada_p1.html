<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>HC NUBE | FILIACIÓN (1/3)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f4f8; font-family: 'Segoe UI', sans-serif; }
        .form-container { max-width: 900px; margin: 30px auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .header-ohs { display: flex; align-items: center; justify-content: space-between; border-bottom: 3px solid #22c55e; padding-bottom: 15px; margin-bottom: 25px; }
        .title-center { flex: 1; text-align: center; }
        .title-center h2 { font-size: 1.3rem; font-weight: 800; color: #1e293b; text-transform: uppercase; margin: 0; }
        .data-banner { background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 25px; display: flex; justify-content: space-around; border: 1px solid #e2e8f0; }
        .data-item { font-size: 12px; font-weight: 700; color: #64748b; text-transform: uppercase; }
        .data-val { color: #1e293b; font-weight: 900; }
        .label-custom { font-size: 11px; font-weight: 800; color: #334155; text-transform: uppercase; margin-bottom: 5px; }
        .form-control, .form-select { border-radius: 8px; padding: 10px; font-size: 13px; text-transform: uppercase; background: #fdfdfd; }
        .btn-next { background: #22c55e; color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: 800; text-transform: uppercase; margin-top: 20px; transition: 0.3s; }
        .btn-next:hover { background: #16a34a; transform: translateY(-2px); }
    </style>
</head>
<body>

<div class="form-container">
    <div class="header-ohs">
        <img src="https://ingerutonny-ui.github.io/HISTORIAL_CLINICO_NUBE/logo.png" height="50">
        <div class="title-center"><h2>1. Datos de Filiación</h2></div>
        <div style="font-size: 11px; font-weight: 800; color: #94a3b8;">PARTE 1 / 3</div>
    </div>

    <div class="data-banner">
        <div class="data-item">PACIENTE: <span id="p_nombre" class="data-val">---</span></div>
        <div class="data-item">CI: <span id="p_ci" class="data-val">---</span></div>
        <div class="data-item">CÓDIGO: <span id="p_codigo" class="data-val">---</span></div>
    </div>

    <form id="formP1" class="row g-3">
        <div class="col-md-3"><label class="label-custom">Edad</label><input type="number" id="edad" class="form-control" required></div>
        <div class="col-md-3">
            <label class="label-custom">Sexo</label>
            <select id="sexo" class="form-select"><option value="MASCULINO">MASCULINO</option><option value="FEMENINO">FEMENINO</option></select>
        </div>
        <div class="col-md-3"><label class="label-custom">Fecha Nacimiento</label><input type="date" id="fecha_nac" class="form-control" required></div>
        <div class="col-md-3"><label class="label-custom">Lugar Nacimiento</label><input type="text" id="lugar_nac" class="form-control" oninput="this.value=this.value.toUpperCase()"></div>
        
        <div class="col-md-6"><label class="label-custom">Domicilio Actual</label><input type="text" id="domicilio" class="form-control" oninput="this.value=this.value.toUpperCase()"></div>
        <div class="col-md-2"><label class="label-custom">N° Casa</label><input type="text" id="n_casa" class="form-control"></div>
        <div class="col-md-4"><label class="label-custom">Zona / Barrio</label><input type="text" id="zona" class="form-control" oninput="this.value=this.value.toUpperCase()"></div>
        
        <div class="col-md-4"><label class="label-custom">Ciudad</label><input type="text" id="ciudad" class="form-control" oninput="this.value=this.value.toUpperCase()"></div>
        <div class="col-md-4"><label class="label-custom">País</label><input type="text" id="pais" class="form-control" value="BOLIVIA" oninput="this.value=this.value.toUpperCase()"></div>
        <div class="col-md-4"><label class="label-custom">Teléfono/Celular</label><input type="text" id="tel" class="form-control"></div>
        
        <div class="col-md-6">
            <label class="label-custom">Estado Civil</label>
            <select id="est_civil" class="form-select"><option value="SOLTERO/A">SOLTERO/A</option><option value="CASADO/A">CASADO/A</option><option value="DIVORCIADO/A">DIVORCIADO/A</option><option value="VIUDO/A">VIUDO/A</option></select>
        </div>
        <div class="col-md-6"><label class="label-custom">Profesión / Oficio</label><input type="text" id="profesion" class="form-control" oninput="this.value=this.value.toUpperCase()"></div>

        <button type="submit" id="btnNext" class="btn-next">Guardar y Continuar a Parte 2</button>
    </form>
</div>

<script>
    const API = 'https://historial-clinico-936s.onrender.com';

    window.onload = () => {
        const nom = localStorage.getItem('p_nom');
        if (!nom) { alert("No hay datos de registro."); window.location.href="registro_paciente.html"; return; }
        document.getElementById('p_nombre').innerText = nom;
        document.getElementById('p_ci').innerText = localStorage.getItem('p_ci');
        document.getElementById('p_codigo').innerText = localStorage.getItem('p_cod');
    };

    document.getElementById('formP1').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btnNext');
        btn.innerText = "PROCESANDO..."; btn.disabled = true;

        const data = {
            paciente_id: parseInt(localStorage.getItem('p_id')),
            edad: parseInt(document.getElementById('edad').value),
            sexo: document.getElementById('sexo').value,
            fecha_nacimiento: document.getElementById('fecha_nac').value,
            lugar_nacimiento: document.getElementById('lugar_nac').value,
            domicilio: document.getElementById('domicilio').value,
            n_casa: document.getElementById('n_casa').value,
            zona_barrio: document.getElementById('zona').value,
            ciudad: document.getElementById('ciudad').value,
            pais: document.getElementById('pais').value,
            telefono: document.getElementById('tel').value,
            estado_civil: document.getElementById('est_civil').value,
            profesion_oficio: document.getElementById('profesion').value
        };

        try {
            const r = await fetch(`${API}/filiacion/`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            if(r.ok) window.location.href = "declaracion_jurada_p2.html";
            else alert("Error al guardar filiación.");
        } catch(e) { alert("Error de conexión."); }
        finally { btn.disabled = false; btn.innerText = "Guardar y Continuar a Parte 2"; }
    };
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HISTORIAL CL√çNICO NUBE | LISTADO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', sans-serif; }
        .container { max-width: 1100px; margin-top: 30px; }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        .card-header { background: #1e293b; color: white; padding: 20px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        .table thead { background-color: #f8fafc; }
        .table th { font-size: 0.75rem; font-weight: 800; color: #475569; text-transform: uppercase; border-bottom: 2px solid #e2e8f0; }
        .table td { vertical-align: middle; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; color: #1e293b; }
        
        /* BOTONES CON ESTILO */
        .btn-action { 
            padding: 6px 10px; border-radius: 8px; border: none; font-size: 1.1rem; 
            transition: 0.3s; margin: 0 2px; cursor: pointer;
        }
        .btn-reporte { background-color: #22c55e; color: white; }
        .btn-reporte:hover { background-color: #16a34a; transform: scale(1.1); }
        
        .btn-editar { background-color: #f59e0b; color: white; }
        .btn-editar:hover { background-color: #d97706; transform: scale(1.1); }
        
        .btn-borrar { background-color: #ef4444; color: white; }
        .btn-borrar:hover { background-color: #dc2626; transform: scale(1.1); }

        .top-bar { width: 100%; background: #343a40; padding: 10px 20px; color: white; margin-bottom: 20px; }
        .top-bar a { color: white; text-decoration: none; font-weight: 800; font-size: 0.8rem; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="top-bar">
    <a href="registro_paciente.html">‚Üê VOLVER AL REGISTRO</a>
</div>

<div class="container">
    <div class="card">
        <div class="card-header text-center">BASE DE DATOS DE PACIENTES - OHS</div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th class="ps-4">PACIENTE</th>
                            <th>CI</th>
                            <th>C√ìDIGO</th>
                            <th class="text-center">ACCIONES</th>
                        </tr>
                    </thead>
                    <tbody id="listaPacientes">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    const API = 'https://historial-clinico-936s.onrender.com';

    async function cargarPacientes() {
        try {
            const resp = await fetch(`${API}/pacientes/`);
            const pacientes = await resp.json();
            const tabla = document.getElementById('listaPacientes');
            tabla.innerHTML = "";

            pacientes.forEach(p => {
                tabla.innerHTML += `
                    <tr>
                        <td class="ps-4">${p.apellido} ${p.nombre}</td>
                        <td>${p.ci}</td>
                        <td><span class="badge bg-light text-dark border">${p.codigo_paciente}</span></td>
                        <td class="text-center">
                            <button class="btn-action btn-reporte" title="REPORTE" onclick="verReporte(${p.id})">üìÑ</button>
                            <button class="btn-action btn-editar" title="EDITAR" onclick="editarPaciente(${p.id})">‚úèÔ∏è</button>
                            <button class="btn-action btn-borrar" title="BORRAR" onclick="eliminarPaciente(${p.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
        } catch (e) { console.error("Error al cargar lista"); }
    }

    function verReporte(id) {
        localStorage.setItem('p_id_reporte', id);
        window.location.href = "generar_reporte.html";
    }

    function editarPaciente(id) {
        localStorage.setItem('p_id_edicion', id); // Activamos modo edici√≥n
        window.location.href = "declaracion_jurada_p1.html";
    }

    async function eliminarPaciente(id) {
        if (confirm("‚ö†Ô∏è ¬øEST√Å SEGURO DE ELIMINAR ESTE REGISTRO?")) {
            try {
                const r = await fetch(`${API}/pacientes/${id}`, { method: 'DELETE' });
                if (r.ok) cargarPacientes();
            } catch (e) { alert("ERROR AL ELIMINAR"); }
        }
    }

    window.onload = cargarPacientes;
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SISTEMA NUBE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-5">
    <div class="container" style="max-width:400px; background:white; padding:30px; border-radius:20px; shadow:0 0 10px rgba(0,0,0,0.1)">
        <h2 class="text-center mb-4">REGISTRO</h2>
        <form id="f">
            <input type="text" id="n" placeholder="Nombres" class="form-control mb-3" required>
            <input type="text" id="a" placeholder="Apellidos" class="form-control mb-3" required>
            <input type="text" id="ci" placeholder="CI" class="form-control mb-3" required>
            <input type="text" id="c" class="form-control mb-3" readonly style="background:#eee">
            <button type="submit" id="b" class="btn btn-primary w-100">REGISTRAR</button>
        </form>
    </div>

    <script>
        const API = "https://historial-clinico-936s.onrender.com/pacientes/";
        const n = document.getElementById('n'), a = document.getElementById('a'), c = document.getElementById('c');

        function gen() { 
            if(n.value && a.value) c.value = n.value[0].toUpperCase() + a.value[0].toUpperCase() + Math.floor(1000+Math.random()*9000);
        }
        n.oninput = gen; a.oninput = gen;

        document.getElementById('f').onsubmit = async (e) => {
            e.preventDefault();
            const b = document.getElementById('b');
            b.innerText = "ENVIANDO...";
            try {
                const r = await fetch(API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({nombres:n.value, apellidos:a.value, documento_identidad:document.getElementById('ci').value, codigo_paciente:c.value})
                });
                if(r.ok) { alert("EXITO"); location.reload(); }
                else { alert("ERROR"); }
            } catch (e) { alert("FALLO DE RED"); }
            b.innerText = "REGISTRAR";
        };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>HISTORIAL CL√çNICO NUBE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background:#f8f9fa; display:flex; flex-direction:column; align-items:center; padding-top:50px; }
        .box { background:white; padding:40px; border-radius:30px; box-shadow:0 10px 40px rgba(0,0,0,0.05); width:400px; }
        .form-control { background:#f4f7fa; border:none; margin-bottom:15px; padding:12px; }
        .btn-reg { background:#2d6df6; color:white; width:100%; padding:15px; border:none; border-radius:12px; font-weight:700; }
        #codigo_display { background:#f0f4ff!important; color:#2d6df6!important; text-align:center; font-weight:800; display:none; }
    </style>
</head>
<body>
    <div class="box">
        <h2 class="text-center">REGISTRO</h2>
        <form id="formRegistro">
            <input type="text" id="nombres" placeholder="NOMBRES" class="form-control" required>
            <input type="text" id="apellidos" placeholder="APELLIDOS" class="form-control" required>
            <input type="text" id="ci" placeholder="DOCUMENTO (CI)" class="form-control" required>
            <input type="text" id="codigo_display" class="form-control" readonly>
            <button type="submit" id="btn" class="btn-reg">REGISTRAR PACIENTE</button>
        </form>
    </div>

    <script>
        const API = "https://historial-clinico-936s.onrender.com/pacientes/";

        const n = document.getElementById('nombres');
        const a = document.getElementById('apellidos');
        const c = document.getElementById('codigo_display');

        function gen() {
            if(n.value && a.value) {
                if(!c.value) c.value = n.value[0].toUpperCase() + a.value[0].toUpperCase() + Math.floor(1000+Math.random()*9000);
                c.style.display = 'block';
            }
        }
        n.oninput = gen; a.oninput = gen;

        document.getElementById('formRegistro').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn');
            btn.innerText = "ENVIANDO...";
            
            const data = {
                nombres: n.value,
                apellidos: a.value,
                documento_identidad: document.getElementById('ci').value,
                codigo_paciente: c.value
            };

            try {
                const r = await fetch(API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if(r.ok) { alert("REGISTRADO"); location.reload(); }
                else { const err = await r.json(); alert(err.detail); }
            } catch (err) { alert("FALLO DE RED"); }
            btn.innerText = "REGISTRAR PACIENTE";
        };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HISTORIAL_CLINICO_NUBE | DECLARACIÓN JURADA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', sans-serif; padding: 20px; text-transform: uppercase; }
        .form-container { max-width: 1100px; margin: auto; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .titulo-principal { font-weight: 800; text-align: center; margin-bottom: 30px; color: #1e293b; }
        .seccion-titulo { background-color: #f3f6f9; padding: 10px 20px; border-radius: 10px; font-weight: 800; margin-top: 25px; margin-bottom: 15px; font-size: 14px; }
        .form-label { font-size: 11px; font-weight: 800; margin-bottom: 3px; display: block; }
        .form-control, .form-select { border-radius: 10px; background-color: #f3f6f9; border: 2px solid transparent; font-size: 12px; font-weight: 600; padding: 10px; }
        .desc-enfermedad { font-size: 10px; color: #64748b; font-style: italic; margin-bottom: 10px; line-height: 1.2; }
        .btn-siguiente { background-color: #24a174; border: none; border-radius: 15px; padding: 15px; font-weight: 700; width: 100%; color: white; margin-top: 30px; }
        .hidden { display: none; }
        .grid-riesgos { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; background: #fff; padding: 15px; border: 1px solid #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="form-container">
        <h2 class="titulo-principal">DECLARACIÓN JURADA DE SALUD</h2>

        <form id="formSeccion1">
            <div class="seccion-titulo">1. AFILIACIÓN DEL TRABAJADOR</div>
            <div class="row g-3">
                <div class="col-md-8"><label class="form-label">APELLIDOS Y NOMBRES</label><input type="text" id="nombre_completo" class="form-control" readonly style="background-color: #f0fdf4;"></div>
                <div class="col-md-4"><label class="form-label">CÓDIGO DE PACIENTE</label><input type="text" id="codigo_id" class="form-control" readonly style="background-color: #f0fdf4; text-align: center;"></div>
                <div class="col-md-2"><label class="form-label">EDAD</label><input type="number" id="edad" class="form-control" required></div>
                <div class="col-md-3"><label class="form-label">SEXO</label><select id="sexo" class="form-select"><option value="MASCULINO">MASCULINO</option><option value="FEMENINO">FEMENINO</option></select></div>
                <div class="col-md-4"><label class="form-label">FECHA DE NACIMIENTO</label><input type="date" id="fecha_nacimiento" class="form-control"></div>
                <div class="col-md-3"><label class="form-label">LUGAR</label><input type="text" id="lugar_nacimiento" class="form-control"></div>
                <div class="col-md-5"><label class="form-label">AV./CALLE</label><input type="text" id="domicilio_av_calle" class="form-control"></div>
                <div class="col-md-2"><label class="form-label">NÚMERO</label><input type="text" id="domicilio_numero" class="form-control"></div>
                <div class="col-md-5"><label class="form-label">BARRIO</label><input type="text" id="barrio" class="form-control"></div>
                <div class="col-md-4"><label class="form-label">CIUDAD</label><input type="text" id="ciudad" class="form-control"></div>
                <div class="col-md-4"><label class="form-label">PAÍS</label><input type="text" id="pais" class="form-control" value="BOLIVIA"></div>
                <div class="col-md-4"><label class="form-label">TELÉFONO</label><input type="text" id="telefono" class="form-control"></div>
                <div class="col-md-4"><label class="form-label">ESTADO CIVIL</label><input type="text" id="estado_civil" class="form-control"></div>
                <div class="col-md-8"><label class="form-label">PROFESIÓN O LABOR</label><input type="text" id="profesion_labor" class="form-control"></div>
            </div>
            <button type="submit" class="btn-siguiente">SIGUIENTE: SECCIÓN 2</button>
        </form>

        <form id="formSeccion2" class="hidden">
            <div class="seccion-titulo">2. ANTECEDENTES DE SALUD (SI O NO)</div>
            <p style="font-size: 11px; font-weight: bold;">LEA CON CUIDADO Y MARQUE SI USTED FUE DIAGNOSTICADO DE:</p>
            <div class="row" id="contenedorSalud"></div>
            <div class="seccion-titulo">ALERGIAS</div>
            <div class="row g-3">
                <div class="col-md-6"><label class="form-label">MEDICAMENTOS</label><input type="text" id="alergia_med" class="form-control" placeholder="INDIQUE CUÁL O 'NO'"></div>
                <div class="col-md-6"><label class="form-label">ALIMENTOS</label><input type="text" id="alergia_ali" class="form-control" placeholder="INDIQUE CUÁL O 'NO'"></div>
            </div>
            <button type="submit" class="btn-siguiente">SIGUIENTE: SECCIÓN 3</button>
        </form>

        <form id="formSeccion3" class="hidden">
            <div class="seccion-titulo">3.1 HÁBITOS</div>
            <div class="row g-3 mb-3 text-center" style="font-size: 10px; font-weight: bold;">
                <div class="col-md-3"></div><div class="col-md-2">¿PRACTICA?</div><div class="col-md-3">CANTIDAD</div><div class="col-md-4">FRECUENCIA</div>
            </div>
            <div class="row g-2 align-items-center mb-2">
                <div class="col-md-3"><label class="form-label">ALCOHOL</label></div>
                <div class="col-md-2"><select id="h_alc_sn" class="form-select"><option value="NO">NO</option><option value="SI">SI</option></select></div>
                <div class="col-md-3"><input type="text" id="h_alc_cant" class="form-control"></div>
                <div class="col-md-4"><input type="text" id="h_alc_freq" class="form-control"></div>
            </div>
            <div class="row g-2 align-items-center mb-2">
                <div class="col-md-3"><label class="form-label">TABACO</label></div>
                <div class="col-md-2"><select id="h_tab_sn" class="form-select"><option value="NO">NO</option><option value="SI">SI</option></select></div>
                <div class="col-md-3"><input type="text" id="h_tab_cant" class="form-control"></div>
                <div class="col-md-4"><input type="text" id="h_tab_freq" class="form-control"></div>
            </div>
            <div class="row g-2 align-items-center mb-2">
                <div class="col-md-3"><label class="form-label">COCA (BOLO) / DROGAS</label></div>
                <div class="col-md-2"><select id="h_coca_sn" class="form-select"><option value="NO">NO</option><option value="SI">SI</option></select></div>
                <div class="col-md-3"><input type="text" id="h_coca_cant" class="form-control"></div>
                <div class="col-md-4"><input type="text" id="h_coca_freq" class="form-control"></div>
            </div>

            <div class="seccion-titulo">3.2 ANTECEDENTES OCUPACIONALES</div>
            <textarea id="historia_laboral" class="form-control" rows="4" placeholder="HISTORIA LABORAL COMPLETA..."></textarea>

            <div class="seccion-titulo">3.3 RIESGOS EXPUESTOS DURANTE SU VIDA LABORAL</div>
            <div class="grid-riesgos">
                <div><label class="form-label">RUIDO</label><input type="text" id="r_ruido" class="form-control"></div>
                <div><label class="form-label">RADIACIÓN</label><input type="text" id="r_radiacion" class="form-control"></div>
                <div><label class="form-label">VIBRACIÓN</label><input type="text" id="r_vibracion" class="form-control"></div>
                <div><label class="form-label">MECÁNICOS</label><input type="text" id="r_mecanicos" class="form-control"></div>
                <div><label class="form-label">TEMP. EXTREMAS</label><input type="text" id="r_temperatura" class="form-control"></div>
                <div><label class="form-label">POLVO</label><input type="text" id="r_polvo" class="form-control"></div>
                <div><label class="form-label">HUMOS</label><input type="text" id="r_humos" class="form-control"></div>
                <div><label class="form-label">GASES</label><input type="text" id="r_gases" class="form-control"></div>
                <div><label class="form-label">METALES PESADOS</label><input type="text" id="r_metales" class="form-control"></div>
                <div><label class="form-label">PLOMO,CADMIO,ETC</label><input type="text" id="r_plomo" class="form-control"></div>
                <div><label class="form-label">MOV. REPETITIVOS</label><input type="text" id="r_repetitivos" class="form-control"></div>
                <div><label class="form-label">LEVANTAMIENTO CARGA</label><input type="text" id="r_carga" class="form-control"></div>
                <div><label class="form-label">PSICOLÓGICOS</label><input type="text" id="r_psicologico" class="form-control"></div>
                <div><label class="form-label">BIOLÓGICOS</label><input type="text" id="r_biologico" class="form-control"></div>
                <div><label class="form-label">TRABAJO EN ALTURA</label><input type="text" id="r_altura" class="form-control"></div>
                <div><label class="form-label">ESPACIOS CONFINADOS</label><input type="text" id="r_confinados" class="form-control"></div>
                <div><label class="form-label">OTROS</label><input type="text" id="r_otros" class="form-control"></div>
            </div>

            <div class="mt-3">
                <label class="form-label">OBSERVACIONES</label>
                <input type="text" id="observaciones" class="form-control">
            </div>

            <button type="submit" class="btn-siguiente" style="background-color: #1e293b;">FINALIZAR Y GUARDAR EN NUBE</button>
        </form>
    </div>

    <script>
        const API_URL = "https://historial-clinico-936s.onrender.com/declaraciones/";

        const dataSalud = [
            { id: "vista", t: "VISTA", d: "Disminución visión, Daltonismo, Glaucoma, Retinopatía, Pterigión, Miopía." },
            { id: "auditivo", t: "AUDITIVO", d: "Sordera, Otitis, Trauma acústico, Vértigo." },
            { id: "respiratorios", t: "RESPIRATORIOS", d: "Tuberculosis, EPOC, Asma, Bronquitis, Rinitis." },
            { id: "cardio", t: "CARDIO-VASCULARES", d: "Presión alta, Arritmia, Trombosis, Infarto, Insuficiencia Cardiaca." },
            { id: "digestivo", t: "ESTOMAGO/HIGADO", d: "Gastritis, Úlcera, Reflujo, Cirrosis, Hernia, Hemorroides." },
            { id: "sangre", t: "SANGRE", d: "Anemia, Coagulopatía, Poliglobulia." },
            { id: "urinario", t: "GENITO/URINARIO", d: "Insuficiencia renal, Infección urinaria, Cistitis, ITS." },
            { id: "nervioso", t: "SISTEMA NERVIOSO", d: "Epilepsia, Vértigo, Migraña, TEC." },
            { id: "psiquiatrico", t: "PSIQUIATRICOS", d: "Depresión, Ansiedad, Psicosis." },
            { id: "oseo", t: "OSTEOMUSCULARES", d: "Lumbalgia, Escoliosis, Fracturas, Artralgia." },
            { id: "metabolico", t: "METABOLICOS", d: "Diabetes, Tiroides, Obesidad, Gota." },
            { id: "reuma", t: "REUMATOLOGICOS", d: "Artritis Reumatoide, Lupus." },
            { id: "generales", t: "GENERALES", d: "Cáncer, Hernias Abdominales." },
            { id: "piel", t: "DERMATOLOGICAS", d: "Dermatitis, Psoriasis, Vitíligo, Hongos." },
            { id: "infecciones", t: "INFECCIONES", d: "Hepatitis, Tifoidea, HIV, Chagas." }
        ];

        window.onload = () => {
            document.getElementById('nombre_completo').value = localStorage.getItem('temp_nombres_completos') || "";
            document.getElementById('codigo_id').value = localStorage.getItem('temp_codigo') || "0";
            const cont = document.getElementById('contenedorSalud');
            dataSalud.forEach(p => {
                cont.innerHTML += `<div class="col-md-6 mb-3"><label class="form-label">${p.t}</label><div class="desc-enfermedad">${p.d}</div><select id="${p.id}" class="form-select"><option value="NO">NO</option><option value="SI">SI</option></select></div>`;
            });
        };

        document.body.addEventListener('input', (e) => { if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') e.target.value = e.target.value.toUpperCase(); });

        document.getElementById('formSeccion1').onsubmit = (e) => { e.preventDefault(); document.getElementById('formSeccion1').classList.add('hidden'); document.getElementById('formSeccion2').classList.remove('hidden'); window.scrollTo(0,0); };
        document.getElementById('formSeccion2').onsubmit = (e) => { e.preventDefault(); document.getElementById('formSeccion2').classList.add('hidden'); document.getElementById('formSeccion3').classList.remove('hidden'); window.scrollTo(0,0); };

        document.getElementById('formSeccion3').onsubmit = async (e) => {
            e.preventDefault();
            const payload = {
                paciente_id: parseInt(localStorage.getItem('temp_paciente_id')),
                edad: parseInt(document.getElementById('edad').value),
                sexo: document.getElementById('sexo').value,
                fecha_nacimiento: document.getElementById('fecha_nacimiento').value,
                lugar_nacimiento: document.getElementById('lugar_nacimiento').value,
                domicilio_av_calle: document.getElementById('domicilio_av_calle').value,
                domicilio_numero: document.getElementById('domicilio_numero').value,
                barrio: document.getElementById('barrio').value,
                ciudad: document.getElementById('ciudad').value,
                pais: document.getElementById('pais').value,
                telefono: document.getElementById('telefono').value,
                estado_civil: document.getElementById('estado_civil').value,
                profesion_labor: document.getElementById('profesion_labor').value,
                vista: document.getElementById('vista').value,
                auditivo: document.getElementById('auditivo').value,
                respiratorios: document.getElementById('respiratorios').value,
                cardio: document.getElementById('cardio').value,
                digestivo: document.getElementById('digestivo').value,
                sangre: document.getElementById('sangre').value,
                urinario: document.getElementById('urinario').value,
                nervioso: document.getElementById('nervioso').value,
                psiquiatrico: document.getElementById('psiquiatrico').value,
                oseo: document.getElementById('oseo').value,
                metabolico: document.getElementById('metabolico').value,
                reuma: document.getElementById('reuma').value,
                generales: document.getElementById('generales').value,
                piel: document.getElementById('piel').value,
                infecciones: document.getElementById('infecciones').value,
                alergia_med: document.getElementById('alergia_med').value,
                alergia_ali: document.getElementById('alergia_ali').value,
                h_alc_sn: document.getElementById('h_alc_sn').value,
                h_alc_cant: document.getElementById('h_alc_cant').value,
                h_alc_freq: document.getElementById('h_alc_freq').value,
                h_tab_sn: document.getElementById('h_tab_sn').value,
                h_tab_cant: document.getElementById('h_tab_cant').value,
                h_tab_freq: document.getElementById('h_tab_freq').value,
                h_coca_sn: document.getElementById('h_coca_sn').value,
                h_coca_cant: document.getElementById('h_coca_cant').value,
                h_coca_freq: document.getElementById('h_coca_freq').value,
                historia_laboral: document.getElementById('historia_laboral').value,
                r_ruido: document.getElementById('r_ruido').value,
                r_radiacion: document.getElementById('r_radiacion').value,
                r_vibracion: document.getElementById('r_vibracion').value,
                r_mecanicos: document.getElementById('r_mecanicos').value,
                r_temperatura: document.getElementById('r_temperatura').value,
                r_polvo: document.getElementById('r_polvo').value,
                r_humos: document.getElementById('r_humos').value,
                r_gases: document.getElementById('r_gases').value,
                r_metales: document.getElementById('r_metales').value,
                r_plomo: document.getElementById('r_plomo').value,
                r_repetitivos: document.getElementById('r_repetitivos').value,
                r_carga: document.getElementById('r_carga').value,
                r_psicologico: document.getElementById('r_psicologico').value,
                r_biologico: document.getElementById('r_biologico').value,
                r_altura: document.getElementById('r_altura').value,
                r_confinados: document.getElementById('r_confinados').value,
                r_otros: document.getElementById('r_otros').value,
                observaciones: document.getElementById('observaciones').value
            };

            try {
                const res = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (res.ok) { alert("GUARDADO EXITOSO"); window.location.href = "final.html"; }
                else { alert("ERROR AL GUARDAR"); }
            } catch (e) { alert("ERROR DE CONEXIÓN"); }
        };
    </script>
</body>
</html>
